<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Empréstimos - Notebooks</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        /* Reset e Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-orange: #FF6B35;
            --dark-orange: #E55100;
            --light-orange: #FFB74D;
            --black: #1a1a1a;
            --dark-gray: #2c2c2c;
            --medium-gray: #404040;
            --light-gray: #f5f5f5;
            --white: #ffffff;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #F44336;
            --info: #2196F3;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
            color: var(--white);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--dark-orange) 100%);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-stats {
            display: flex;
            gap: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            min-width: 120px;
        }

        .stat-number {
            display: block;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--white);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            gap: 5px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            color: var(--white);
            cursor: pointer;
            border-radius: calc(var(--border-radius) - 5px);
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn:hover {
            background: rgba(255,107,53,0.1);
            color: var(--primary-orange);
        }

        .tab-btn.active {
            background: var(--primary-orange);
            color: var(--white);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .notebooks-grid h2,
        .emprestimos-ativos h2 {
            color: var(--primary-orange);
            margin-bottom: 20px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .notebooks-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .notebook-card {
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            cursor: pointer;
        }

        .notebook-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-orange);
        }

        .notebook-card.disponivel {
            border-color: var(--success);
        }

        .notebook-card.disponivel::before {
            background: var(--success);
        }

        .notebook-card.emprestado {
            border-color: var(--danger);
        }

        .notebook-card.emprestado::before {
            background: var(--danger);
        }

        .notebook-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .notebook-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--primary-orange);
        }

        .notebook-number {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .notebook-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: inline-block;
        }

        .status-disponivel {
            background: var(--success);
            color: var(--white);
        }

        .status-emprestado {
            background: var(--danger);
            color: var(--white);
        }

        .notebook-info {
            font-size: 0.95rem;
            opacity: 0.85;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .notebook-info strong {
            color: var(--primary-orange);
        }

        .notebook-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* Empréstimos Ativos */
        .emprestimos-list {
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            padding: 25px;
            max-height: 650px;
            overflow-y: auto;
        }

        .emprestimo-item {
            background: rgba(255,107,53,0.1);
            border: 1px solid var(--primary-orange);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            transition: var(--transition);
            cursor: pointer;
        }

        .emprestimo-item:hover {
            background: rgba(255,107,53,0.2);
            transform: translateX(5px);
        }

        .emprestimo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .emprestimo-notebook {
            font-weight: 700;
            color: var(--primary-orange);
            font-size: 1.1rem;
        }

        .emprestimo-status {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-ativo {
            background: var(--warning);
            color: var(--black);
        }

        .status-atrasado {
            background: var(--danger);
            color: var(--white);
        }

        .emprestimo-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            font-size: 0.9rem;
        }

        .emprestimo-info > div {
            display: flex;
            flex-direction: column;
        }

        .emprestimo-info strong {
            color: var(--light-orange);
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        /* Formulário */
        .form-container {
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 700px;
            margin: 0 auto;
            box-shadow: var(--shadow);
        }

        .form-container h2 {
            color: var(--primary-orange);
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-orange);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--border-radius);
            background: var(--black);
            color: var(--white);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(255,107,53,0.1);
        }

        .form-group small {
            color: var(--light-orange);
            font-size: 0.8rem;
            margin-top: 5px;
            display: block;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Gestão de Setores */
        .setores-management {
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .setores-management h3 {
            color: var(--primary-orange);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .setores-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: end;
        }

        .setores-form input {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--border-radius);
            background: var(--black);
            color: var(--white);
        }

        .setores-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .setor-item {
            background: rgba(255,107,53,0.1);
            border: 1px solid var(--primary-orange);
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .setor-remove {
            background: var(--danger);
            color: var(--white);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 0.7rem;
        }

        /* Botões */
        .btn-primary,
        .btn-secondary,
        .btn-success,
        .btn-danger,
        .btn-info,
        .btn-warning {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-orange);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--dark-orange);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--black);
            color: var(--white);
            border: 2px solid var(--primary-orange);
        }

        .btn-secondary:hover {
            background: var(--primary-orange);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-info {
            background: var(--info);
            color: var(--white);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--black);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* Calendário */
        .calendario-container {
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .calendario-container h2 {
            color: var(--primary-orange);
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
        }

        .calendario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .calendario-header h3 {
            color: var(--primary-orange);
            font-size: 1.8rem;
        }

        .btn-calendar {
            background: var(--primary-orange);
            color: var(--white);
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-calendar:hover {
            background: var(--dark-orange);
            transform: scale(1.1);
        }

        .calendario-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: var(--black);
            border-radius: var(--border-radius);
            padding: 2px;
        }

        .calendario-day {
            background: var(--dark-gray);
            padding: 15px 8px;
            text-align: center;
            font-size: 0.9rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .calendario-day.header {
            background: var(--primary-orange);
            color: var(--white);
            font-weight: 700;
            min-height: 50px;
            justify-content: center;
        }

        .calendario-day.hoje {
            background: var(--primary-orange);
            color: var(--white);
            font-weight: 700;
        }

        .calendario-day.devolucao {
            background: var(--warning);
            color: var(--black);
        }

        .calendario-day.atrasado {
            background: var(--danger);
            color: var(--white);
        }

        .calendario-day.outro-mes {
            opacity: 0.3;
        }

        .calendario-evento {
            background: rgba(255,107,53,0.2);
            border: 1px solid var(--primary-orange);
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 0.7rem;
            margin-top: 2px;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }

        .calendario-evento:hover {
            background: rgba(255,107,53,0.4);
        }

        /* Histórico */
        .historico-container {
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .historico-container h2 {
            color: var(--primary-orange);
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
        }

        .historico-filters {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--black);
            border-radius: var(--border-radius);
        }

        .historico-table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
        }

        .historico-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--black);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .historico-table th {
            background: var(--primary-orange);
            color: var(--white);
            padding: 15px;
            text-align: left;
            font-weight: 700;
        }

        .historico-table td {
            padding: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .historico-table tr:hover {
            background: var(--dark-gray);
            cursor: pointer;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-devolvido {
            background: var(--success);
            color: var(--white);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--dark-gray);
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid var(--medium-gray);
            background: var(--primary-orange);
        }

        .modal-header h3 {
            color: var(--white);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--medium-gray);
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .detalhe-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--medium-gray);
        }

        .detalhe-item:last-child {
            border-bottom: none;
        }

        .detalhe-label {
            font-weight: 600;
            color: var(--primary-orange);
        }

        .detalhe-valor {
            color: var(--white);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            color: var(--white);
            font-weight: 600;
            z-index: 1001;
            animation: toastSlideIn 0.3s ease-out;
        }

        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        .toast.warning { background: var(--warning); color: var(--black); }

        @keyframes toastSlideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { padding: 20px; }
            .header-content { flex-direction: column; text-align: center; }
            .header h1 { font-size: 2rem; }
            .nav-tabs { flex-direction: column; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .notebooks-container { grid-template-columns: 1fr; }
            .historico-filters { grid-template-columns: 1fr; }
            .emprestimo-info { grid-template-columns: 1fr; }
            .setores-form { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-laptop"></i> Sistema de Empréstimos</h1>
                <div class="header-stats">
                    <div class="stat-card">
                        <span class="stat-number" id="disponiveisCount">15</span>
                        <span class="stat-label">Disponíveis</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="emprestadosCount">0</span>
                        <span class="stat-label">Em Uso</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="dashboard">
                <i class="fas fa-home"></i> Dashboard
            </button>
            <button class="tab-btn" data-tab="solicitar">
                <i class="fas fa-plus"></i> Nova Solicitação
            </button>
            <button class="tab-btn" data-tab="calendario">
                <i class="fas fa-calendar"></i> Calendário
            </button>
            <button class="tab-btn" data-tab="historico">
                <i class="fas fa-history"></i> Histórico
            </button>
            <button class="tab-btn" data-tab="setores">
                <i class="fas fa-building"></i> Setores
            </button>
        </nav>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="dashboard-grid">
                <div class="notebooks-grid">
                    <h2><i class="fas fa-laptop"></i> Status dos Notebooks</h2>
                    <div class="notebooks-container" id="notebooksContainer">
                        <!-- Notebooks serão gerados dinamicamente -->
                    </div>
                </div>
                
                <div class="emprestimos-ativos">
                    <h2><i class="fas fa-clipboard-list"></i> Empréstimos Ativos</h2>
                    <div class="emprestimos-list" id="emprestimosAtivos">
                        <div style="text-align: center; padding: 40px; opacity: 0.7;">
                            <i class="fas fa-clipboard-list" style="font-size: 3rem; margin-bottom: 15px; color: var(--primary-orange);"></i>
                            <p>Nenhum empréstimo ativo</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Solicitar Tab -->
        <div class="tab-content" id="solicitar">
            <div class="form-container">
                <h2>Nova Solicitação de Empréstimo</h2>
                <form id="formSolicitacao">
                    <div class="form-group">
                        <label for="nomeColaborador">Nome do Colaborador:</label>
                        <input type="text" id="nomeColaborador" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="setorColaborador">Setor:</label>
                        <select id="setorColaborador" required>
                            <option value="">Selecione o setor</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="notebookSelecionado">Notebook Desejado:</label>
                        <select id="notebookSelecionado" required>
                            <option value="">Selecione um notebook disponível</option>
                        </select>
                        <small>
                            <i class="fas fa-info-circle"></i> Apenas notebooks disponíveis são exibidos
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="numeroChamado">Número do Chamado:</label>
                        <input type="text" id="numeroChamado" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivoEmprestimo">Motivo do Empréstimo:</label>
                        <textarea id="motivoEmprestimo" rows="3" required placeholder="Descreva o motivo da solicitação..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataPrevisaoDevolucao">Previsão de Devolução:</label>
                        <input type="date" id="dataPrevisaoDevolucao" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-check"></i> Solicitar Empréstimo
                        </button>
                        <button type="reset" class="btn-secondary">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Calendário Tab -->
        <div class="tab-content" id="calendario">
            <div class="calendario-container">
                <h2>Calendário de Devoluções</h2>
                <div class="calendario-header">
                    <button id="prevMonth" class="btn-calendar"><i class="fas fa-chevron-left"></i></button>
                    <h3 id="currentMonth">Junho 2025</h3>
                    <button id="nextMonth" class="btn-calendar"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendario-grid" id="calendarioGrid">
                    <!-- Calendário será gerado dinamicamente -->
                </div>
                <div style="display: flex; justify-content: center; gap: 30px; margin-top: 20px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; background: var(--primary-orange); border-radius: 4px;"></div>
                        <span>Hoje</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; background: var(--warning); border-radius: 4px;"></div>
                        <span>Devolução Prevista</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; background: var(--danger); border-radius: 4px;"></div>
                        <span>Atrasado</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Histórico Tab -->
        <div class="tab-content" id="historico">
            <div class="historico-container">
                <h2>Histórico de Empréstimos</h2>
                <div class="historico-filters">
                    <input type="text" id="filtroNome" placeholder="Filtrar por nome...">
                    <select id="filtroSetor">
                        <option value="">Todos os setores</option>
                    </select>
                    <input type="month" id="filtroMes">
                </div>
                <div class="historico-table-container">
                    <table class="historico-table">
                        <thead>
                            <tr>
                                <th>Notebook</th>
                                <th>Colaborador</th>
                                <th>Setor</th>
                                <th>Chamado</th>
                                <th>Entrega</th>
                                <th>Devolução</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="historicoTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; opacity: 0.7;">
                                    <i class="fas fa-history" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-orange);"></i><br>
                                    Nenhum histórico disponível
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Setores Tab -->
        <div class="tab-content" id="setores">
            <div class="setores-management">
                <h3><i class="fas fa-building"></i> Gerenciar Setores</h3>
                <div class="setores-form">
                    <input type="text" id="novoSetor" placeholder="Digite o nome do novo setor...">
                    <button type="button" class="btn-primary" onclick="sistema.adicionarSetor()">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
                <div class="setores-list" id="setoresList">
                    <!-- Lista de setores será gerada dinamicamente -->
                </div>
            </div>
            
            <!-- Gestão de Notebooks -->
            <div class="setores-management" style="margin-top: 30px;">
                <h3><i class="fas fa-laptop"></i> Gestão de Notebooks</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                    <button class="btn-primary" onclick="sistema.abrirModalAdicionarNotebook()">
                        <i class="fas fa-plus"></i> Adicionar Notebook
                    </button>
                    <button class="btn-warning" onclick="sistema.abrirModalEdicaoMassa()">
                        <i class="fas fa-edit"></i> Editar Todos em Massa
                    </button>
                    <button class="btn-primary" onclick="sistema.abrirModalGerarLote()">
                        <i class="fas fa-magic"></i> Gerar em Lote
                    </button>
                    <button class="btn-info" onclick="sistema.exportarConfiguracao()">
                        <i class="fas fa-download"></i> Exportar
                    </button>
                    <label class="btn-warning" for="importarConfig" style="cursor: pointer; margin: 0;">
                        <i class="fas fa-upload"></i> Importar
                        <input type="file" id="importarConfig" accept=".json" style="display: none;" onchange="sistema.importarConfiguracao(this)">
                    </label>
                    <button class="btn-danger" onclick="sistema.resetarNotebooks()">
                        <i class="fas fa-trash"></i> Resetar
                    </button>
                </div>
                
                <!-- Contador de notebooks -->
                <div style="background: var(--black); border-radius: var(--border-radius); padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Total de Notebooks: <strong id="totalNotebooks" style="color: var(--primary-orange);">0</strong></span>
                        <span>Disponíveis: <strong id="disponiveis" style="color: var(--success);">0</strong></span>
                        <span>Em Uso: <strong id="emUso" style="color: var(--danger);">0</strong></span>
                    </div>
                </div>
                
                <!-- Lista de notebooks para edição -->
                <div style="background: var(--black); border-radius: var(--border-radius); padding: 20px;">
                    <h4 style="color: var(--primary-orange); margin-bottom: 15px;">Notebooks Cadastrados</h4>
                    <div id="listaNotebooksEdicao" style="max-height: 400px; overflow-y: auto;">
                        <!-- Lista será preenchida dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Detalhes -->
        <div class="modal" id="modalDetalhes">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Detalhes do Empréstimo</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body" id="detalhesEmprestimo">
                    <!-- Detalhes serão inseridos dinamicamente -->
                </div>
                <div class="modal-footer">
                    <button class="modal-close btn-secondary">Fechar</button>
                </div>
            </div>
        </div>

        <!-- Modal para Devolução -->
        <div class="modal" id="modalDevolucao">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirmar Devolução</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Confirmar devolução do notebook <strong id="notebookDevolucao"></strong>?</p>
                    <div class="form-group">
                        <label for="observacoesDevolucao">Observações:</label>
                        <textarea id="observacoesDevolucao" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="confirmarDevolucao" class="btn-primary">Confirmar Devolução</button>
                    <button class="modal-close btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal para Editar Notebook -->
        <div class="modal" id="modalEditarNotebook">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Editar Notebook</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="formEditarNotebook">
                        <div class="form-group">
                            <label for="editNumero">Número do Notebook:</label>
                            <input type="text" id="editNumero" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editSerie">Número de Série:</label>
                            <input type="text" id="editSerie" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editRfid">RFID:</label>
                            <input type="text" id="editRfid" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editDescricao">Descrição (Opcional):</label>
                            <textarea id="editDescricao" rows="3" placeholder="Adicione informações extras sobre o notebook..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="editModelo">Modelo (Opcional):</label>
                            <input type="text" id="editModelo" placeholder="Ex: Lenovo ThinkPad, Dell Latitude...">
                        </div>
                        
                        <div class="form-group">
                            <label for="editProcessador">Processador (Opcional):</label>
                            <input type="text" id="editProcessador" placeholder="Ex: Intel i5, AMD Ryzen...">
                        </div>
                        
                        <div class="form-group">
                            <label for="editMemoria">Memória RAM (Opcional):</label>
                            <input type="text" id="editMemoria" placeholder="Ex: 8GB, 16GB...">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="salvarEdicaoNotebook" class="btn-primary">
                        <i class="fas fa-save"></i> Salvar Alterações
                    </button>
                    <button class="modal-close btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal para Geração em Lote -->
        <div class="modal" id="modalGerarLote">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Gerar Notebooks em Lote</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="prefixoNumero">Prefixo do Número:</label>
                        <input type="text" id="prefixoNumero" value="EMPRESTIMO_" placeholder="Ex: LAPTOP_, NB_, EMPRESTIMO_">
                    </div>
                    
                    <div class="form-group">
                        <label for="prefixoRfid">Prefixo RFID:</label>
                        <input type="text" id="prefixoRfid" value="RF" placeholder="Ex: RF, RFID, TAG">
                    </div>
                    
                    <div class="form-group">
                        <label for="numeroInicial">Número Inicial:</label>
                        <input type="number" id="numeroInicial" value="1" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="rfidInicial">RFID Inicial:</label>
                        <input type="number" id="rfidInicial" value="200795" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="sufixoSerie">Sufixo da Série:</label>
                        <input type="text" id="sufixoSerie" value="DD3" placeholder="Ex: DD3, ABC, XYZ">
                    </div>
                    
                    <div style="background: rgba(255,107,53,0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <p style="margin: 0; font-size: 0.9rem;">
                            <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
                            <strong>Atenção:</strong> Esta ação irá recriar todos os 15 notebooks com as novas configurações. 
                            Notebooks em uso não serão afetados.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="gerarNotebooksLote" class="btn-primary">
                        <i class="fas fa-magic"></i> Gerar Notebooks
                    </button>
                    <button class="modal-close btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal para Edição em Massa -->
        <div class="modal" id="modalEdicaoMassa">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>Edição em Massa - Todos os Notebooks</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div style="background: rgba(255,107,53,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="margin: 0; font-size: 0.9rem;">
                            <i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
                            <strong>Atenção:</strong> Esta ação irá alterar TODOS os notebooks. Notebooks em uso não serão afetados.
                        </p>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;" id="listaEdicaoMassa">
                        <!-- Lista será preenchida dinamicamente -->
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--medium-gray);">
                        <button class="btn-primary" onclick="sistema.aplicarPadrao()">
                            <i class="fas fa-magic"></i> Aplicar Padrão Automático
                        </button>
                        <small style="display: block; margin-top: 5px; opacity: 0.8;">
                            Gera automaticamente números sequenciais para série e RFID
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="salvarEdicaoMassa" class="btn-primary">
                        <i class="fas fa-save"></i> Salvar Todas as Alterações
                    </button>
                    <button class="modal-close btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal para Adicionar Novo Notebook -->
        <div class="modal" id="modalAdicionarNotebook">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Adicionar Novo Notebook</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="formAdicionarNotebook">
                        <div class="form-group">
                            <label for="novoNumero">Número do Notebook:</label>
                            <input type="text" id="novoNumero" required placeholder="Ex: EMPRESTIMO_16">
                        </div>
                        
                        <div class="form-group">
                            <label for="novaSerie">Número de Série:</label>
                            <input type="text" id="novaSerie" required placeholder="Ex: 5678ABC">
                        </div>
                        
                        <div class="form-group">
                            <label for="novoRfid">RFID:</label>
                            <input type="text" id="novoRfid" required placeholder="Ex: 200810">
                        </div>
                        
                        <div class="form-group">
                            <label for="novoModelo">Modelo (Opcional):</label>
                            <input type="text" id="novoModelo" placeholder="Ex: Dell Latitude 5520">
                        </div>
                        
                        <div class="form-group">
                            <label for="novoProcessador">Processador (Opcional):</label>
                            <input type="text" id="novoProcessador" placeholder="Ex: Intel i5-1135G7">
                        </div>
                        
                        <div class="form-group">
                            <label for="novaMemoria">Memória RAM (Opcional):</label>
                            <input type="text" id="novaMemoria" placeholder="Ex: 8GB DDR4">
                        </div>
                        
                        <div class="form-group">
                            <label for="novaDescricao">Descrição (Opcional):</label>
                            <textarea id="novaDescricao" rows="3" placeholder="Informações adicionais sobre o notebook..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="confirmarAdicionarNotebook" class="btn-primary">
                        <i class="fas fa-plus"></i> Adicionar Notebook
                    </button>
                    <button class="modal-close btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SistemaEmprestimos {
            constructor() {
                this.notebooks = this.initializeNotebooks();
                this.emprestimos = JSON.parse(localStorage.getItem('emprestimos')) || [];
                this.setores = JSON.parse(localStorage.getItem('setores')) || this.getDefaultSetores();
                this.currentMonth = new Date();
                this.init();
            }

            getDefaultSetores() {
                return [
                    "Dados Mestre",
                    "Customer Service", 
                    "T.I",
                    "CD VERA CRUZ",
                    "Suprimentos",
                    "ADM RH",
                    "Logística",
                    "Controladoria Fiscal"
                ];
            }

            initializeNotebooks() {
                const savedNotebooks = JSON.parse(localStorage.getItem('notebooks'));
                if (savedNotebooks && savedNotebooks.length > 0) return savedNotebooks;

                const notebooks = [];
                for (let i = 1; i <= 15; i++) {
                    notebooks.push({
                        id: i,
                        numero: `EMPRESTIMO_${i.toString().padStart(2, '0')}`,
                        serie: `${Math.floor(Math.random() * 9000) + 1000}DD3`,
                        rfid: `${200794 + i}`,
                        modelo: '',
                        processador: '',
                        memoria: '',
                        descricao: '',
                        dataCadastro: new Date().toISOString(),
                        status: 'disponivel',
                        colaborador: null,
                        setor: null,
                        chamado: null,
                        dataEntrega: null,
                        previsaoDevolucao: null
                    });
                }
                
                localStorage.setItem('notebooks', JSON.stringify(notebooks));
                return notebooks;
            }

            init() {
                this.setupEventListeners();
                this.renderDashboard();
                this.renderCalendario();
                this.renderHistorico();
                this.renderSetores();
                this.renderListaNotebooksEdicao();
                this.updateStats();
                this.setMinDate();
                this.updateNotebookOptions();
                this.updateSetorOptions();
            }

            setupEventListeners() {
                // Navegação entre tabs
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabName = e.target.closest('.tab-btn').dataset.tab;
                        this.switchTab(tabName);
                    });
                });

                // Formulário
                document.getElementById('formSolicitacao').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.criarSolicitacao();
                });

                // Reset do formulário
                document.getElementById('formSolicitacao').addEventListener('reset', () => {
                    setTimeout(() => this.updateNotebookOptions(), 100);
                });

                // Calendário
                document.getElementById('prevMonth').addEventListener('click', () => {
                    this.currentMonth.setMonth(this.currentMonth.getMonth() - 1);
                    this.renderCalendario();
                });

                document.getElementById('nextMonth').addEventListener('click', () => {
                    this.currentMonth.setMonth(this.currentMonth.getMonth() + 1);
                    this.renderCalendario();
                });

                // Filtros do histórico
                document.getElementById('filtroNome').addEventListener('input', () => this.renderHistorico());
                document.getElementById('filtroSetor').addEventListener('change', () => this.renderHistorico());
                document.getElementById('filtroMes').addEventListener('change', () => this.renderHistorico());

                // Modal
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', () => this.closeModal());
                });

                document.getElementById('confirmarDevolucao').addEventListener('click', () => {
                    this.confirmarDevolucao();
                });

                // Fechar modal ao clicar fora
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        this.closeModal();
                    }
                });

                // Tecla ESC para fechar modal
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal();
                    }
                });

                // Adicionar setor com Enter
                document.getElementById('novoSetor').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.adicionarSetor();
                    }
                });

                // Event listeners para edição de notebooks
                document.getElementById('salvarEdicaoNotebook').addEventListener('click', () => {
                    this.salvarEdicaoNotebook();
                });

                document.getElementById('gerarNotebooksLote').addEventListener('click', () => {
                    this.gerarNotebooksLote();
                });

                // Event listeners para novas funcionalidades
                document.getElementById('salvarEdicaoMassa').addEventListener('click', () => {
                    this.salvarEdicaoMassa();
                });

                document.getElementById('confirmarAdicionarNotebook').addEventListener('click', () => {
                    this.confirmarAdicionarNotebook();
                });
            }

            setMinDate() {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('dataPrevisaoDevolucao').min = tomorrow.toISOString().split('T')[0];
            }

            updateNotebookOptions() {
                const select = document.getElementById('notebookSelecionado');
                if (!select) return;

                const notebooksDisponiveis = this.notebooks.filter(nb => nb.status === 'disponivel');
                
                select.innerHTML = '<option value="">Selecione um notebook disponível</option>';
                
                if (notebooksDisponiveis.length === 0) {
                    select.innerHTML = '<option value="">Nenhum notebook disponível</option>';
                    select.disabled = true;
                } else {
                    select.disabled = false;
                    notebooksDisponiveis.forEach(notebook => {
                        const option = document.createElement('option');
                        option.value = notebook.id;
                        option.textContent = `${notebook.numero} (Série: ${notebook.serie})`;
                        select.appendChild(option);
                    });
                }
            }

            updateSetorOptions() {
                // Atualiza select de setores no formulário
                const selectSetor = document.getElementById('setorColaborador');
                if (selectSetor) {
                    const valorAtual = selectSetor.value;
                    selectSetor.innerHTML = '<option value="">Selecione o setor</option>';
                    this.setores.forEach(setor => {
                        const option = document.createElement('option');
                        option.value = setor;
                        option.textContent = setor;
                        selectSetor.appendChild(option);
                    });
                    selectSetor.value = valorAtual;
                }

                // Atualiza filtro de setores no histórico
                const filtroSetor = document.getElementById('filtroSetor');
                if (filtroSetor) {
                    const valorAtual = filtroSetor.value;
                    filtroSetor.innerHTML = '<option value="">Todos os setores</option>';
                    this.setores.forEach(setor => {
                        const option = document.createElement('option');
                        option.value = setor;
                        option.textContent = setor;
                        filtroSetor.appendChild(option);
                    });
                    filtroSetor.value = valorAtual;
                }
            }

            switchTab(tabName) {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(tabName).classList.add('active');

                switch(tabName) {
                    case 'calendario':
                        this.renderCalendario();
                        break;
                    case 'solicitar':
                        this.updateNotebookOptions();
                        break;
                    case 'historico':
                        this.renderHistorico();
                        break;
                    case 'setores':
                        this.renderSetores();
                        this.renderListaNotebooksEdicao();
                        break;
                }
            }

            criarSolicitacao() {
                const nome = document.getElementById('nomeColaborador').value.trim();
                const setor = document.getElementById('setorColaborador').value;
                const notebookId = parseInt(document.getElementById('notebookSelecionado').value);
                const chamado = document.getElementById('numeroChamado').value.trim();
                const motivo = document.getElementById('motivoEmprestimo').value.trim();
                const previsaoDevolucao = document.getElementById('dataPrevisaoDevolucao').value;

                // Validações
                if (!nome || !setor || !notebookId || !chamado || !motivo || !previsaoDevolucao) {
                    this.showToast('Todos os campos são obrigatórios!', 'error');
                    return;
                }

                if (nome.length < 2) {
                    this.showToast('Nome deve ter pelo menos 2 caracteres!', 'error');
                    return;
                }

                if (chamado.length < 3) {
                    this.showToast('Número do chamado deve ter pelo menos 3 caracteres!', 'error');
                    return;
                }

                if (motivo.length < 10) {
                    this.showToast('Motivo deve ter pelo menos 10 caracteres!', 'error');
                    return;
                }

                // Verifica se o notebook selecionado ainda está disponível
                const notebookSelecionado = this.notebooks.find(nb => nb.id === notebookId && nb.status === 'disponivel');
                if (!notebookSelecionado) {
                    this.showToast('O notebook selecionado não está mais disponível!', 'error');
                    this.updateNotebookOptions();
                    return;
                }

                const agora = new Date();
                const emprestimo = {
                    id: Date.now(),
                    notebookId: notebookSelecionado.id,
                    colaborador: nome,
                    setor: setor,
                    chamado: chamado,
                    motivo: motivo,
                    dataEntrega: agora.toISOString(),
                    previsaoDevolucao: previsaoDevolucao,
                    status: 'ativo'
                };

                // Atualiza o notebook selecionado
                notebookSelecionado.status = 'emprestado';
                notebookSelecionado.colaborador = nome;
                notebookSelecionado.setor = setor;
                notebookSelecionado.chamado = chamado;
                notebookSelecionado.dataEntrega = agora.toISOString();
                notebookSelecionado.previsaoDevolucao = previsaoDevolucao;

                this.emprestimos.push(emprestimo);
                this.saveData();

                // Limpa formulário e atualiza opções
                document.getElementById('formSolicitacao').reset();
                this.setMinDate();
                this.updateNotebookOptions();

                this.showToast(`Notebook ${notebookSelecionado.numero} emprestado com sucesso para ${nome}!`, 'success');
                this.renderDashboard();
                this.updateStats();
                this.switchTab('dashboard');
            }

            renderDashboard() {
                const container = document.getElementById('notebooksContainer');
                container.innerHTML = this.notebooks.map(notebook => {
                    const isAtrasado = notebook.status === 'emprestado' && this.isAtrasado(notebook.previsaoDevolucao);
                    
                    return `
                        <div class="notebook-card ${notebook.status}" onclick="sistema.mostrarDetalhesNotebook(${notebook.id})">
                            <div class="notebook-icon">
                                <i class="fas fa-laptop"></i>
                            </div>
                            <div class="notebook-number">${notebook.numero}</div>
                            <div class="notebook-status status-${notebook.status}">
                                ${notebook.status === 'disponivel' ? 'Disponível' : 'Em Uso'}
                                ${isAtrasado ? ' (Atrasado)' : ''}
                            </div>
                            ${notebook.status === 'emprestado' ? `
                                <div class="notebook-info">
                                    <strong>${notebook.colaborador}</strong><br>
                                    <span style="color: var(--light-orange);">${notebook.setor}</span><br>
                                    <small>Chamado: ${notebook.chamado}</small><br>
                                    <small>Devolução: ${this.formatDate(notebook.previsaoDevolucao)}</small>
                                </div>
                            ` : '<div class="notebook-info">Pronto para empréstimo</div>'}
                            <div class="notebook-actions">
                                ${notebook.status === 'emprestado' ? `
                                    <button class="btn-danger btn-small" onclick="event.stopPropagation(); sistema.abrirModalDevolucao(${notebook.id})">
                                        <i class="fas fa-undo"></i> Devolver
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                // Empréstimos ativos
                const ativos = this.emprestimos.filter(emp => emp.status === 'ativo');
                const emprestimosContainer = document.getElementById('emprestimosAtivos');
                
                if (ativos.length === 0) {
                    emprestimosContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; opacity: 0.7;">
                            <i class="fas fa-clipboard-list" style="font-size: 3rem; margin-bottom: 15px; color: var(--primary-orange);"></i>
                            <p>Nenhum empréstimo ativo</p>
                        </div>
                    `;
                } else {
                    emprestimosContainer.innerHTML = ativos.map(emprestimo => {
                        const notebook = this.notebooks.find(nb => nb.id === emprestimo.notebookId);
                        const previsao = new Date(emprestimo.previsaoDevolucao);
                        const hoje = new Date();
                        const isAtrasado = previsao < hoje;
                        const diasRestantes = Math.ceil((previsao - hoje) / (1000 * 60 * 60 * 24));
                        
                        return `
                            <div class="emprestimo-item" onclick="sistema.mostrarDetalhesEmprestimo(${emprestimo.id})">
                                <div class="emprestimo-header">
                                    <span class="emprestimo-notebook">${notebook ? notebook.numero : 'N/A'}</span>
                                    <span class="emprestimo-status ${isAtrasado ? 'status-atrasado' : 'status-ativo'}">
                                        ${isAtrasado ? `Atrasado (${Math.abs(diasRestantes)} dias)` : 
                                          diasRestantes === 0 ? 'Vence Hoje' :
                                          diasRestantes === 1 ? 'Vence Amanhã' :
                                          `${diasRestantes} dias restantes`}
                                    </span>
                                </div>
                                <div class="emprestimo-info">
                                    <div><strong>Colaborador</strong><span>${emprestimo.colaborador}</span></div>
                                    <div><strong>Setor</strong><span>${emprestimo.setor}</span></div>
                                    <div><strong>Chamado</strong><span>${emprestimo.chamado}</span></div>
                                    <div><strong>Devolução</strong><span>${this.formatDate(emprestimo.previsaoDevolucao)}</span></div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }

            renderCalendario() {
                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
                
                document.getElementById('currentMonth').textContent = 
                    `${monthNames[this.currentMonth.getMonth()]} ${this.currentMonth.getFullYear()}`;

                const firstDay = new Date(this.currentMonth.getFullYear(), this.currentMonth.getMonth(), 1);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                let html = '';
                dayNames.forEach(day => {
                    html += `<div class="calendario-day header">${day}</div>`;
                });

                const currentDate = new Date(startDate);
                for (let i = 0; i < 42; i++) {
                    const isCurrentMonth = currentDate.getMonth() === this.currentMonth.getMonth();
                    const isToday = currentDate.toDateString() === new Date().toDateString();
                    
                    let classes = 'calendario-day';
                    if (!isCurrentMonth) classes += ' outro-mes';
                    if (isToday) classes += ' hoje';

                    // Verifica empréstimos com devolução neste dia
                    const emprestimosHoje = this.emprestimos.filter(emp => {
                        if (emp.status !== 'ativo') return false;
                        const previsao = new Date(emp.previsaoDevolucao);
                        return previsao.toDateString() === currentDate.toDateString();
                    });

                    const hoje = new Date();
                    hoje.setHours(0, 0, 0, 0);
                    const currentDateCopy = new Date(currentDate);
                    currentDateCopy.setHours(0, 0, 0, 0);

                    if (emprestimosHoje.length > 0) {
                        if (currentDateCopy < hoje) {
                            classes += ' atrasado';
                        } else {
                            classes += ' devolucao';
                        }
                    }

                    let eventosHtml = '';
                    emprestimosHoje.forEach(emp => {
                        const notebook = this.notebooks.find(nb => nb.id === emp.notebookId);
                        const nomeAbrev = emp.colaborador.split(' ')[0];
                        eventosHtml += `
                            <div class="calendario-evento" 
                                 title="${emp.colaborador} - ${notebook ? notebook.numero : 'N/A'} - ${emp.chamado}"
                                 onclick="sistema.mostrarDetalhesEmprestimo(${emp.id})">
                                ${nomeAbrev} - ${notebook ? notebook.numero : 'N/A'}
                            </div>
                        `;
                    });

                    html += `
                        <div class="${classes}" title="${currentDate.toLocaleDateString('pt-BR')}">
                            <div>${currentDate.getDate()}</div>
                            ${eventosHtml}
                        </div>
                    `;

                    currentDate.setDate(currentDate.getDate() + 1);
                }

                document.getElementById('calendarioGrid').innerHTML = html;
            }

            renderHistorico() {
                const filtroNome = document.getElementById('filtroNome').value.toLowerCase();
                const filtroSetor = document.getElementById('filtroSetor').value;
                const filtroMes = document.getElementById('filtroMes').value;

                let emprestimosFiltered = [...this.emprestimos];

                // Aplica filtros
                if (filtroNome.trim()) {
                    emprestimosFiltered = emprestimosFiltered.filter(emp => 
                        emp.colaborador.toLowerCase().includes(filtroNome)
                    );
                }

                if (filtroSetor) {
                    emprestimosFiltered = emprestimosFiltered.filter(emp => emp.setor === filtroSetor);
                }

                if (filtroMes) {
                    emprestimosFiltered = emprestimosFiltered.filter(emp => {
                        const dataEntrega = new Date(emp.dataEntrega);
                        const mesAno = `${dataEntrega.getFullYear()}-${(dataEntrega.getMonth() + 1).toString().padStart(2, '0')}`;
                        return mesAno === filtroMes;
                    });
                }

                // Ordena por data mais recente
                emprestimosFiltered.sort((a, b) => new Date(b.dataEntrega) - new Date(a.dataEntrega));

                const tbody = document.getElementById('historicoTableBody');
                
                if (emprestimosFiltered.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; opacity: 0.7;">
                                <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-orange);"></i><br>
                                Nenhum empréstimo encontrado
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = emprestimosFiltered.map(emprestimo => {
                        const notebook = this.notebooks.find(nb => nb.id === emprestimo.notebookId);
                        let statusClass = 'status-ativo';
                        let statusText = 'Ativo';
                        
                        if (emprestimo.status === 'devolvido') {
                            statusClass = 'status-devolvido';
                            statusText = 'Devolvido';
                        } else if (emprestimo.status === 'ativo') {
                            const previsao = new Date(emprestimo.previsaoDevolucao);
                            const hoje = new Date();
                            if (previsao < hoje) {
                                statusClass = 'status-atrasado';
                                statusText = 'Atrasado';
                            }
                        }

                        return `
                            <tr onclick="sistema.mostrarDetalhesEmprestimo(${emprestimo.id})">
                                <td><strong>${notebook ? notebook.numero : 'N/A'}</strong></td>
                                <td>${emprestimo.colaborador}</td>
                                <td>${emprestimo.setor}</td>
                                <td>${emprestimo.chamado}</td>
                                <td>${this.formatDateTime(emprestimo.dataEntrega)}</td>
                                <td>${emprestimo.dataDevolucao ? this.formatDateTime(emprestimo.dataDevolucao) : '-'}</td>
                                <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            </tr>
                        `;
                    }).join('');
                }
            }

            renderSetores() {
                const container = document.getElementById('setoresList');
                container.innerHTML = this.setores.map(setor => `
                    <div class="setor-item">
                        <span>${setor}</span>
                        <button class="setor-remove" onclick="sistema.removerSetor('${setor}')" title="Remover setor">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');
            }

            renderListaNotebooksEdicao() {
                const container = document.getElementById('listaNotebooksEdicao');
                if (!container) return;

                container.innerHTML = this.notebooks.map(notebook => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 10px; background: var(--dark-gray); border-radius: 8px; border-left: 4px solid ${notebook.status === 'disponivel' ? 'var(--success)' : 'var(--danger)'};">
                        <div>
                            <strong style="color: var(--primary-orange);">${notebook.numero}</strong><br>
                            <small>Série: ${notebook.serie} | RFID: ${notebook.rfid}</small><br>
                            <small style="color: ${notebook.status === 'disponivel' ? 'var(--success)' : 'var(--danger)'};">
                                ${notebook.status === 'disponivel' ? 'Disponível' : `Em uso - ${notebook.colaborador}`}
                            </small>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-info btn-small" onclick="sistema.mostrarDetalhesNotebook(${notebook.id})" title="Ver detalhes">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${notebook.status === 'disponivel' ? `
                                <button class="btn-primary btn-small" onclick="sistema.abrirModalEditarNotebook(${notebook.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }

            adicionarSetor() {
                const input = document.getElementById('novoSetor');
                const novoSetor = input.value.trim();

                if (!novoSetor) {
                    this.showToast('Digite o nome do setor!', 'error');
                    return;
                }

                if (this.setores.includes(novoSetor)) {
                    this.showToast('Este setor já existe!', 'warning');
                    return;
                }

                this.setores.push(novoSetor);
                this.saveData();
                this.renderSetores();
                this.updateSetorOptions();
                input.value = '';
                this.showToast('Setor adicionado com sucesso!', 'success');
            }

            removerSetor(setor) {
                if (confirm(`Tem certeza que deseja remover o setor "${setor}"?`)) {
                    this.setores = this.setores.filter(s => s !== setor);
                    this.saveData();
                    this.renderSetores();
                    this.updateSetorOptions();
                    this.showToast('Setor removido com sucesso!', 'success');
                }
            }

            mostrarDetalhesNotebook(notebookId) {
                const notebook = this.notebooks.find(nb => nb.id === notebookId);
                const emprestimo = this.emprestimos.find(emp => 
                    emp.notebookId === notebookId && emp.status === 'ativo'
                );

                let detalhesHtml = `
                    <div class="detalhe-item">
                        <span class="detalhe-label">Notebook:</span>
                        <span class="detalhe-valor">${notebook.numero}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Série:</span>
                        <span class="detalhe-valor">${notebook.serie}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">RFID:</span>
                        <span class="detalhe-valor">${notebook.rfid}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Status:</span>
                        <span class="detalhe-valor">
                            <span class="status-badge status-${notebook.status}">
                                ${notebook.status === 'disponivel' ? 'Disponível' : 'Em Uso'}
                            </span>
                        </span>
                    </div>
                `;

                if (notebook.modelo) {
                    detalhesHtml += `
                        <div class="detalhe-item">
                            <span class="detalhe-label">Modelo:</span>
                            <span class="detalhe-valor">${notebook.modelo}</span>
                        </div>
                    `;
                }

                if (notebook.processador) {
                    detalhesHtml += `
                        <div class="detalhe-item">
                            <span class="detalhe-label">Processador:</span>
                            <span class="detalhe-valor">${notebook.processador}</span>
                        </div>
                    `;
                }

                if (notebook.memoria) {
                    detalhesHtml += `
                        <div class="detalhe-item">
                            <span class="detalhe-label">Memória:</span>
                            <span class="detalhe-valor">${notebook.memoria}</span>
                        </div>
                    `;
                }

                if (notebook.descricao) {
                    detalhesHtml += `
                        <div class="detalhe-item">
                            <span class="detalhe-label">Descrição:</span>
                            <span class="detalhe-valor">${notebook.descricao}</span>
                        </div>
                    `;
                }

                if (emprestimo) {
                    detalhesHtml += `
                        <hr style="margin: 20px 0; border: 1px solid var(--medium-gray);">
                        <h4 style="color: var(--primary-orange); margin-bottom: 15px;">Empréstimo Atual</h4>
                        <div class="detalhe-item">
                            <span class="detalhe-label">Colaborador:</span>
                            <span class="detalhe-valor">${emprestimo.colaborador}</span>
                        </div>
                        <div class="detalhe-item">
                            <span class="detalhe-label">Setor:</span>
                            <span class="detalhe-valor">${emprestimo.setor}</span>
                        </div>
                        <div class="detalhe-item">
                            <span class="detalhe-label">Chamado:</span>
                            <span class="detalhe-valor">${emprestimo.chamado}</span>
                        </div>
                        <div class="detalhe-item">
                            <span class="detalhe-label">Motivo:</span>
                            <span class="detalhe-valor">${emprestimo.motivo}</span>
                        </div>
                        <div class="detalhe-item">
                            <span class="detalhe-label">Data Entrega:</span>
                            <span class="detalhe-valor">${this.formatDateTime(emprestimo.dataEntrega)}</span>
                        </div>
                        <div class="detalhe-item">
                            <span class="detalhe-label">Previsão Devolução:</span>
                            <span class="detalhe-valor">${this.formatDate(emprestimo.previsaoDevolucao)}</span>
                        </div>
                    `;
                }

                // Adiciona botão de edição se disponível
                if (notebook.status === 'disponivel') {
                    detalhesHtml += `
                        <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--medium-gray);">
                            <button class="btn-primary" onclick="sistema.abrirModalEditarNotebook(${notebook.id})" style="margin-right: 10px;">
                                <i class="fas fa-edit"></i> Editar Notebook
                            </button>
                        </div>
                    `;
                }

                document.getElementById('detalhesEmprestimo').innerHTML = detalhesHtml;
                document.getElementById('modalDetalhes').classList.add('active');
            }

            mostrarDetalhesEmprestimo(emprestimoId) {
                const emprestimo = this.emprestimos.find(emp => emp.id === emprestimoId);
                const notebook = this.notebooks.find(nb => nb.id === emprestimo.notebookId);

                let detalhesHtml = `
                    <div class="detalhe-item">
                        <span class="detalhe-label">Notebook:</span>
                        <span class="detalhe-valor">${notebook ? notebook.numero : 'N/A'}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Colaborador:</span>
                        <span class="detalhe-valor">${emprestimo.colaborador}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Setor:</span>
                        <span class="detalhe-valor">${emprestimo.setor}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Chamado:</span>
                        <span class="detalhe-valor">${emprestimo.chamado}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Motivo:</span>
                        <span class="detalhe-valor">${emprestimo.motivo}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Data Entrega:</span>
                        <span class="detalhe-valor">${this.formatDateTime(emprestimo.dataEntrega)}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Previsão Devolução:</span>
                        <span class="detalhe-valor">${this.formatDate(emprestimo.previsaoDevolucao)}</span>
                    </div>
                    <div class="detalhe-item">
                        <span class="detalhe-label">Status:</span>
                        <span class="detalhe-valor">
                            <span class="status-badge ${emprestimo.status === 'devolvido' ? 'status-devolvido' : this.isAtrasado(emprestimo.previsaoDevolucao) ? 'status-atrasado' : 'status-ativo'}">
                                ${emprestimo.status === 'devolvido' ? 'Devolvido' : this.isAtrasado(emprestimo.previsaoDevolucao) ? 'Atrasado' : 'Ativo'}
                            </span>
                        </span>
                    </div>
                `;

                if (emprestimo.dataDevolucao) {
                    detalhesHtml += `
                        <div class="detalhe-item">
                            <span class="detalhe-label">Data Devolução:</span>
                            <span class="detalhe-valor">${this.formatDateTime(emprestimo.dataDevolucao)}</span>
                        </div>
                    `;
                }

                if (emprestimo.observacoesDevolucao) {
                    detalhesHtml += `
                        <div class="detalhe-item">
                            <span class="detalhe-label">Observações:</span>
                            <span class="detalhe-valor">${emprestimo.observacoesDevolucao}</span>
                        </div>
                    `;
                }

                document.getElementById('detalhesEmprestimo').innerHTML = detalhesHtml;
                document.getElementById('modalDetalhes').classList.add('active');
            }

            abrirModalEditarNotebook(notebookId) {
                const notebook = this.notebooks.find(nb => nb.id === notebookId);
                if (!notebook || notebook.status !== 'disponivel') {
                    this.showToast('Apenas notebooks disponíveis podem ser editados!', 'error');
                    return;
                }

                // Preenche os campos do formulário
                document.getElementById('editNumero').value = notebook.numero;
                document.getElementById('editSerie').value = notebook.serie;
                document.getElementById('editRfid').value = notebook.rfid;
                document.getElementById('editDescricao').value = notebook.descricao || '';
                document.getElementById('editModelo').value = notebook.modelo || '';
                document.getElementById('editProcessador').value = notebook.processador || '';
                document.getElementById('editMemoria').value = notebook.memoria || '';

                // Fecha modal de detalhes e abre modal de edição
                this.closeModal();
                document.getElementById('modalEditarNotebook').classList.add('active');
                document.getElementById('modalEditarNotebook').dataset.notebookId = notebookId;
            }

            salvarEdicaoNotebook() {
                const notebookId = parseInt(document.getElementById('modalEditarNotebook').dataset.notebookId);
                const notebook = this.notebooks.find(nb => nb.id === notebookId);

                if (!notebook) {
                    this.showToast('Notebook não encontrado!', 'error');
                    return;
                }

                const novoNumero = document.getElementById('editNumero').value.trim();
                const novaSerie = document.getElementById('editSerie').value.trim();
                const novoRfid = document.getElementById('editRfid').value.trim();
                const novaDescricao = document.getElementById('editDescricao').value.trim();
                const novoModelo = document.getElementById('editModelo').value.trim();
                const novoProcessador = document.getElementById('editProcessador').value.trim();
                const novaMemoria = document.getElementById('editMemoria').value.trim();

                // Validações
                if (!novoNumero || !novaSerie || !novoRfid) {
                    this.showToast('Número, Série e RFID são obrigatórios!', 'error');
                    return;
                }

                // Verifica duplicatas
                const numeroExistente = this.notebooks.find(nb => nb.id !== notebookId && nb.numero === novoNumero);
                const rfidExistente = this.notebooks.find(nb => nb.id !== notebookId && nb.rfid === novoRfid);

                if (numeroExistente) {
                    this.showToast('Já existe um notebook com este número!', 'error');
                    return;
                }

                if (rfidExistente) {
                    this.showToast('Já existe um notebook com este RFID!', 'error');
                    return;
                }

                // Atualiza o notebook
                notebook.numero = novoNumero;
                notebook.serie = novaSerie;
                notebook.rfid = novoRfid;
                notebook.descricao = novaDescricao;
                notebook.modelo = novoModelo;
                notebook.processador = novoProcessador;
                notebook.memoria = novaMemoria;

                this.saveData();
                this.closeModal();
                this.renderDashboard();
                this.renderListaNotebooksEdicao();
                this.updateNotebookOptions();

                this.showToast('Notebook atualizado com sucesso!', 'success');
            }

            abrirModalGerarLote() {
                document.getElementById('modalGerarLote').classList.add('active');
            }

            gerarNotebooksLote() {
                const prefixoNumero = document.getElementById('prefixoNumero').value.trim();
                const prefixoRfid = document.getElementById('prefixoRfid').value.trim();
                const numeroInicial = parseInt(document.getElementById('numeroInicial').value);
                const rfidInicial = parseInt(document.getElementById('rfidInicial').value);
                const sufixoSerie = document.getElementById('sufixoSerie').value.trim();

                if (!prefixoNumero || !prefixoRfid || !numeroInicial || !rfidInicial || !sufixoSerie) {
                    this.showToast('Todos os campos são obrigatórios!', 'error');
                    return;
                }

                if (!confirm('Tem certeza? Esta ação irá recriar todos os notebooks disponíveis.')) {
                    return;
                }

                // Preserva notebooks em uso
                const notebooksEmUso = this.notebooks.filter(nb => nb.status === 'emprestado');
                
                // Recria apenas os disponíveis
                const novosNotebooks = [];

                for (let i = 1; i <= 15; i++) {
                    const notebookEmUso = notebooksEmUso.find(nb => nb.id === i);
                    
                    if (notebookEmUso) {
                        novosNotebooks.push(notebookEmUso);
                    } else {
                        novosNotebooks.push({
                            id: i,
                            numero: `${prefixoNumero}${(numeroInicial + i - 1).toString().padStart(2, '0')}`,
                            serie: `${Math.floor(Math.random() * 9000) + 1000}${sufixoSerie}`,
                            rfid: `${prefixoRfid}${rfidInicial + i - 1}`,
                            modelo: '',
                            processador: '',
                            memoria: '',
                            descricao: '',
                            dataCadastro: new Date().toISOString(),
                            status: 'disponivel',
                            colaborador: null,
                            setor: null,
                            chamado: null,
                            dataEntrega: null,
                            previsaoDevolucao: null
                        });
                    }
                }

                this.notebooks = novosNotebooks;
                this.saveData();
                this.closeModal();
                this.renderDashboard();
                this.renderListaNotebooksEdicao();
                this.updateNotebookOptions();
                this.updateStats();

                this.showToast('Notebooks gerados com sucesso!', 'success');
            }

            abrirModalEdicaoMassa() {
                this.renderListaEdicaoMassa();
                document.getElementById('modalEdicaoMassa').classList.add('active');
            }

            renderListaEdicaoMassa() {
                const container = document.getElementById('listaEdicaoMassa');
                if (!container) return;

                container.innerHTML = this.notebooks.map((notebook, index) => `
                    <div style="display: grid; grid-template-columns: 150px 1fr 1fr 1fr; gap: 15px; align-items: center; padding: 15px; margin-bottom: 10px; background: var(--dark-gray); border-radius: 8px; border-left: 4px solid ${notebook.status === 'disponivel' ? 'var(--success)' : 'var(--danger)'};">
                        <div>
                            <strong style="color: var(--primary-orange);">${notebook.numero}</strong><br>
                            <small style="color: ${notebook.status === 'disponivel' ? 'var(--success)' : 'var(--danger)'};">
                                ${notebook.status === 'disponivel' ? 'Disponível' : 'Em Uso'}
                            </small>
                        </div>
                        <div>
                            <label style="font-size: 0.8rem; color: var(--light-orange);">Série:</label>
                            <input type="text" 
                                   class="massa-serie" 
                                   data-notebook-id="${notebook.id}"
                                   value="${notebook.serie}" 
                                   ${notebook.status !== 'disponivel' ? 'disabled' : ''}
                                   style="width: 100%; padding: 8px; border: 1px solid var(--medium-gray); border-radius: 4px; background: ${notebook.status !== 'disponivel' ? 'var(--medium-gray)' : 'var(--black)'}; color: var(--white); font-size: 0.9rem;">
                        </div>
                        <div>
                            <label style="font-size: 0.8rem; color: var(--light-orange);">RFID:</label>
                            <input type="text" 
                                   class="massa-rfid" 
                                   data-notebook-id="${notebook.id}"
                                   value="${notebook.rfid}" 
                                   ${notebook.status !== 'disponivel' ? 'disabled' : ''}
                                   style="width: 100%; padding: 8px; border: 1px solid var(--medium-gray); border-radius: 4px; background: ${notebook.status !== 'disponivel' ? 'var(--medium-gray)' : 'var(--black)'}; color: var(--white); font-size: 0.9rem;">
                        </div>
                        <div>
                            <label style="font-size: 0.8rem; color: var(--light-orange);">Modelo:</label>
                            <input type="text" 
                                   class="massa-modelo" 
                                   data-notebook-id="${notebook.id}"
                                   value="${notebook.modelo || ''}" 
                                   ${notebook.status !== 'disponivel' ? 'disabled' : ''}
                                   style="width: 100%; padding: 8px; border: 1px solid var(--medium-gray); border-radius: 4px; background: ${notebook.status !== 'disponivel' ? 'var(--medium-gray)' : 'var(--black)'}; color: var(--white); font-size: 0.9rem;"
                                   placeholder="Ex: Dell Latitude">
                        </div>
                    </div>
                `).join('');
            }

            aplicarPadrao() {
                if (!confirm('Aplicar numeração sequencial automática para série e RFID?')) {
                    return;
                }

                document.querySelectorAll('.massa-serie').forEach((input, index) => {
                    if (!input.disabled) {
                        input.value = `${Math.floor(Math.random() * 9000) + 1000}DD3`;
                    }
                });

                document.querySelectorAll('.massa-rfid').forEach((input, index) => {
                    if (!input.disabled) {
                        input.value = `RF${(300000 + parseInt(input.dataset.notebookId)).toString()}`;
                    }
                });

                this.showToast('Padrão aplicado! Revise os dados antes de salvar.', 'success');
            }

            salvarEdicaoMassa() {
                if (!confirm('Salvar todas as alterações? Esta ação não pode ser desfeita.')) {
                    return;
                }

                let alteracoes = 0;

                // Coleta todos os valores
                const novosDados = {};
                document.querySelectorAll('.massa-serie').forEach(input => {
                    if (!input.disabled) {
                        novosDados[input.dataset.notebookId] = {
                            serie: input.value.trim(),
                            rfid: document.querySelector(`.massa-rfid[data-notebook-id="${input.dataset.notebookId}"]`).value.trim(),
                            modelo: document.querySelector(`.massa-modelo[data-notebook-id="${input.dataset.notebookId}"]`).value.trim()
                        };
                    }
                });

                // Validações
                const series = Object.values(novosDados).map(d => d.serie).filter(s => s);
                const rfids = Object.values(novosDados).map(d => d.rfid).filter(r => r);
                
                if (series.length !== new Set(series).size) {
                    this.showToast('Erro: Existem números de série duplicados!', 'error');
                    return;
                }
                
                if (rfids.length !== new Set(rfids).size) {
                    this.showToast('Erro: Existem RFIDs duplicados!', 'error');
                    return;
                }

                // Aplica as alterações
                Object.keys(novosDados).forEach(notebookId => {
                    const notebook = this.notebooks.find(nb => nb.id == notebookId);
                    const dados = novosDados[notebookId];
                    
                    if (notebook && notebook.status === 'disponivel') {
                        if (dados.serie) notebook.serie = dados.serie;
                        if (dados.rfid) notebook.rfid = dados.rfid;
                        if (dados.modelo) notebook.modelo = dados.modelo;
                        alteracoes++;
                    }
                });

                this.saveData();
                this.closeModal();
                this.renderDashboard();
                this.renderListaNotebooksEdicao();
                this.updateNotebookOptions();

                this.showToast(`${alteracoes} notebooks atualizados com sucesso!`, 'success');
            }

            abrirModalAdicionarNotebook() {
                // Sugere próximo número disponível
                const maiorNumero = Math.max(...this.notebooks.map(nb => {
                    const match = nb.numero.match(/(\d+)$/);
                    return match ? parseInt(match[1]) : 0;
                }));
                
                document.getElementById('novoNumero').value = `EMPRESTIMO_${(maiorNumero + 1).toString().padStart(2, '0')}`;
                document.getElementById('novaSerie').value = '';
                document.getElementById('novoRfid').value = '';
                document.getElementById('novoModelo').value = '';
                document.getElementById('novoProcessador').value = '';
                document.getElementById('novaMemoria').value = '';
                document.getElementById('novaDescricao').value = '';
                
                document.getElementById('modalAdicionarNotebook').classList.add('active');
            }

            confirmarAdicionarNotebook() {
                const numero = document.getElementById('novoNumero').value.trim();
                const serie = document.getElementById('novaSerie').value.trim();
                const rfid = document.getElementById('novoRfid').value.trim();
                const modelo = document.getElementById('novoModelo').value.trim();
                const processador = document.getElementById('novoProcessador').value.trim();
                const memoria = document.getElementById('novaMemoria').value.trim();
                const descricao = document.getElementById('novaDescricao').value.trim();

                // Validações
                if (!numero || !serie || !rfid) {
                    this.showToast('Número, Série e RFID são obrigatórios!', 'error');
                    return;
                }

                // Verifica duplicatas
                const numeroExistente = this.notebooks.find(nb => nb.numero === numero);
                const rfidExistente = this.notebooks.find(nb => nb.rfid === rfid);

                if (numeroExistente) {
                    this.showToast('Já existe um notebook com este número!', 'error');
                    return;
                }

                if (rfidExistente) {
                    this.showToast('Já existe um notebook com este RFID!', 'error');
                    return;
                }

                // Cria novo ID
                const novoId = Math.max(...this.notebooks.map(nb => nb.id)) + 1;

                // Adiciona novo notebook
                const novoNotebook = {
                    id: novoId,
                    numero: numero,
                    serie: serie,
                    rfid: rfid,
                    modelo: modelo,
                    processador: processador,
                    memoria: memoria,
                    descricao: descricao,
                    dataCadastro: new Date().toISOString(),
                    status: 'disponivel',
                    colaborador: null,
                    setor: null,
                    chamado: null,
                    dataEntrega: null,
                    previsaoDevolucao: null
                };

                this.notebooks.push(novoNotebook);
                this.saveData();
                this.closeModal();
                this.renderDashboard();
                this.renderListaNotebooksEdicao();
                this.updateNotebookOptions();
                this.updateStats();

                this.showToast(`Notebook ${numero} adicionado com sucesso!`, 'success');
            }

            exportarConfiguracao() {
                const config = {
                    notebooks: this.notebooks.map(nb => ({
                        numero: nb.numero,
                        serie: nb.serie,
                        rfid: nb.rfid,
                        modelo: nb.modelo || '',
                        processador: nb.processador || '',
                        memoria: nb.memoria || '',
                        descricao: nb.descricao || ''
                    })),
                    setores: this.setores,
                    dataExportacao: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(config, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `config_notebooks_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                this.showToast('Configuração exportada com sucesso!', 'success');
            }

            importarConfiguracao(input) {
                const file = input.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const config = JSON.parse(e.target.result);
                        
                        if (!config.notebooks || !Array.isArray(config.notebooks)) {
                            this.showToast('Arquivo de configuração inválido!', 'error');
                            return;
                        }

                        if (!confirm('Importar configuração? Isto irá substituir os notebooks disponíveis.')) {
                            return;
                        }

                        // Preserva notebooks em uso
                        this.notebooks = this.notebooks.map((notebook, index) => {
                            if (notebook.status === 'emprestado') {
                                return notebook; // Mantém notebooks em uso
                            } else if (config.notebooks[index]) {
                                const configNotebook = config.notebooks[index];
                                return {
                                    ...notebook,
                                    numero: configNotebook.numero,
                                    serie: configNotebook.serie,
                                    rfid: configNotebook.rfid,
                                    modelo: configNotebook.modelo || '',
                                    processador: configNotebook.processador || '',
                                    memoria: configNotebook.memoria || '',
                                    descricao: configNotebook.descricao || ''
                                };
                            }
                            return notebook;
                        });

                        if (config.setores) {
                            this.setores = config.setores;
                        }

                        this.saveData();
                        this.renderDashboard();
                        this.renderListaNotebooksEdicao();
                        this.renderSetores();
                        this.updateNotebookOptions();
                        this.updateSetorOptions();
                        
                        this.showToast('Configuração importada com sucesso!', 'success');
                    } catch (error) {
                        this.showToast('Erro ao importar configuração!', 'error');
                    }
                };
                
                reader.readAsText(file);
                input.value = ''; // Limpa o input
            }

            resetarNotebooks() {
                if (!confirm('Tem certeza? Esta ação irá resetar todos os notebooks disponíveis para o padrão.')) {
                    return;
                }

                // Remove apenas notebooks disponíveis do localStorage e recria
                localStorage.removeItem('notebooks');
                this.notebooks = this.initializeNotebooks();
                
                // Restaura empréstimos ativos
                const emprestimosAtivos = this.emprestimos.filter(emp => emp.status === 'ativo');
                emprestimosAtivos.forEach(emp => {
                    const notebook = this.notebooks.find(nb => nb.id === emp.notebookId);
                    if (notebook) {
                        notebook.status = 'emprestado';
                        notebook.colaborador = emp.colaborador;
                        notebook.setor = emp.setor;
                        notebook.chamado = emp.chamado;
                        notebook.dataEntrega = emp.dataEntrega;
                        notebook.previsaoDevolucao = emp.previsaoDevolucao;
                    }
                });

                this.saveData();
                this.renderDashboard();
                this.renderListaNotebooksEdicao();
                this.updateNotebookOptions();
                this.updateStats();
                
                this.showToast('Notebooks resetados para o padrão!', 'success');
            }

            abrirModalDevolucao(notebookId) {
                const notebook = this.notebooks.find(nb => nb.id === notebookId);
                if (!notebook || notebook.status !== 'emprestado') {
                    this.showToast('Notebook não encontrado ou não está emprestado!', 'error');
                    return;
                }

                document.getElementById('notebookDevolucao').textContent = notebook.numero;
                document.getElementById('modalDevolucao').classList.add('active');
                document.getElementById('modalDevolucao').dataset.notebookId = notebookId;
            }

            confirmarDevolucao() {
                const notebookId = parseInt(document.getElementById('modalDevolucao').dataset.notebookId);
                const observacoes = document.getElementById('observacoesDevolucao').value || '';
                
                const notebook = this.notebooks.find(nb => nb.id === notebookId);
                                const emprestimo = this.emprestimos.find(emp => 
                    emp.notebookId === notebookId && emp.status === 'ativo'
                );

                if (!notebook || !emprestimo) {
                    this.showToast('Erro ao processar devolução!', 'error');
                    return;
                }

                const agora = new Date();
                
                emprestimo.status = 'devolvido';
                emprestimo.dataDevolucao = agora.toISOString();
                emprestimo.observacoesDevolucao = observacoes;

                notebook.status = 'disponivel';
                notebook.colaborador = null;
                notebook.setor = null;
                notebook.chamado = null;
                notebook.dataEntrega = null;
                notebook.previsaoDevolucao = null;

                this.saveData();
                this.closeModal();
                this.renderDashboard();
                this.renderHistorico();
                this.updateStats();
                this.updateNotebookOptions();
                this.showToast(`Notebook ${notebook.numero} devolvido com sucesso!`, 'success');
            }

            closeModal() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
                document.getElementById('observacoesDevolucao').value = '';
            }

            updateStats() {
                const disponiveisCount = this.notebooks.filter(nb => nb.status === 'disponivel').length;
                const emprestadosCount = this.notebooks.filter(nb => nb.status === 'emprestado').length;
                const totalCount = this.notebooks.length;
                
                document.getElementById('disponiveisCount').textContent = disponiveisCount;
                document.getElementById('emprestadosCount').textContent = emprestadosCount;
                
                // Atualiza contadores na aba setores se existirem
                const totalEl = document.getElementById('totalNotebooks');
                const disponiveisEl = document.getElementById('disponiveis');
                const emUsoEl = document.getElementById('emUso');
                
                if (totalEl) totalEl.textContent = totalCount;
                if (disponiveisEl) disponiveisEl.textContent = disponiveisCount;
                if (emUsoEl) emUsoEl.textContent = emprestadosCount;
            }

            isAtrasado(previsaoDevolucao) {
                if (!previsaoDevolucao) return false;
                const previsao = new Date(previsaoDevolucao);
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                previsao.setHours(0, 0, 0, 0);
                return previsao < hoje;
            }

            saveData() {
                localStorage.setItem('notebooks', JSON.stringify(this.notebooks));
                localStorage.setItem('emprestimos', JSON.stringify(this.emprestimos));
                localStorage.setItem('setores', JSON.stringify(this.setores));
            }

            showToast(message, type = 'success') {
                document.querySelectorAll('.toast').forEach(toast => toast.remove());

                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'toastSlideIn 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }

            formatDate(dateString) {
                if (!dateString) return '-';
                return new Date(dateString).toLocaleDateString('pt-BR');
            }

            formatDateTime(dateString) {
                if (!dateString) return '-';
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR') + ' às ' + 
                       date.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
            }

            // Métodos adicionais para funcionalidades extras
            
            // Função para buscar empréstimos por critério
            buscarEmprestimos(criterio, valor) {
                return this.emprestimos.filter(emp => {
                    switch(criterio) {
                        case 'colaborador':
                            return emp.colaborador.toLowerCase().includes(valor.toLowerCase());
                        case 'setor':
                            return emp.setor === valor;
                        case 'notebook':
                            const notebook = this.notebooks.find(nb => nb.id === emp.notebookId);
                            return notebook && notebook.numero.toLowerCase().includes(valor.toLowerCase());
                        case 'status':
                            return emp.status === valor;
                        default:
                            return false;
                    }
                });
            }

            // Função para gerar relatório
            gerarRelatorio(periodo = 'mes') {
                const agora = new Date();
                let dataInicio;
                
                switch(periodo) {
                    case 'semana':
                        dataInicio = new Date(agora.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'mes':
                        dataInicio = new Date(agora.getFullYear(), agora.getMonth(), 1);
                        break;
                    case 'trimestre':
                        dataInicio = new Date(agora.getFullYear(), agora.getMonth() - 2, 1);
                        break;
                    case 'ano':
                        dataInicio = new Date(agora.getFullYear(), 0, 1);
                        break;
                    default:
                        dataInicio = new Date(agora.getFullYear(), agora.getMonth(), 1);
                }

                const emprestimosRelativos = this.emprestimos.filter(emp => {
                    const dataEmprestimo = new Date(emp.dataEntrega);
                    return dataEmprestimo >= dataInicio && dataEmprestimo <= agora;
                });

                return {
                    periodo: periodo,
                    dataInicio: dataInicio.toLocaleDateString('pt-BR'),
                    dataFim: agora.toLocaleDateString('pt-BR'),
                    totalEmprestimos: emprestimosRelativos.length,
                    emprestimosAtivos: emprestimosRelativos.filter(emp => emp.status === 'ativo').length,
                    emprestimosDevolvidos: emprestimosRelativos.filter(emp => emp.status === 'devolvido').length,
                    emprestimosAtrasados: emprestimosRelativos.filter(emp => 
                        emp.status === 'ativo' && this.isAtrasado(emp.previsaoDevolucao)
                    ).length,
                    setoresMaisAtivos: this.getSetoresMaisAtivos(emprestimosRelativos),
                    notebooksMaisUsados: this.getNotebooksMaisUsados(emprestimosRelativos)
                };
            }

            getSetoresMaisAtivos(emprestimos) {
                const contadorSetores = {};
                emprestimos.forEach(emp => {
                    contadorSetores[emp.setor] = (contadorSetores[emp.setor] || 0) + 1;
                });
                
                return Object.entries(contadorSetores)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .map(([setor, count]) => ({ setor, emprestimos: count }));
            }

            getNotebooksMaisUsados(emprestimos) {
                const contadorNotebooks = {};
                emprestimos.forEach(emp => {
                    const notebook = this.notebooks.find(nb => nb.id === emp.notebookId);
                    if (notebook) {
                        contadorNotebooks[notebook.numero] = (contadorNotebooks[notebook.numero] || 0) + 1;
                    }
                });
                
                return Object.entries(contadorNotebooks)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .map(([numero, count]) => ({ notebook: numero, emprestimos: count }));
            }

            // Função para notificações de vencimento
            verificarVencimentos() {
                const hoje = new Date();
                const amanha = new Date(hoje);
                amanha.setDate(amanha.getDate() + 1);

                const emprestimosVencendoHoje = this.emprestimos.filter(emp => 
                    emp.status === 'ativo' && 
                    new Date(emp.previsaoDevolucao).toDateString() === hoje.toDateString()
                );

                const emprestimosVencendoAmanha = this.emprestimos.filter(emp => 
                    emp.status === 'ativo' && 
                    new Date(emp.previsaoDevolucao).toDateString() === amanha.toDateString()
                );

                const emprestimosAtrasados = this.emprestimos.filter(emp => 
                    emp.status === 'ativo' && this.isAtrasado(emp.previsaoDevolucao)
                );

                return {
                    vencendoHoje: emprestimosVencendoHoje,
                    vencendoAmanha: emprestimosVencendoAmanha,
                    atrasados: emprestimosAtrasados
                };
            }

            // Função para backup completo dos dados
            fazerBackupCompleto() {
                const backup = {
                    notebooks: this.notebooks,
                    emprestimos: this.emprestimos,
                    setores: this.setores,
                    configuracoes: {
                        versao: '1.0',
                        dataBackup: new Date().toISOString(),
                        totalNotebooks: this.notebooks.length,
                        totalEmprestimos: this.emprestimos.length
                    }
                };

                const blob = new Blob([JSON.stringify(backup, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup_completo_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                this.showToast('Backup completo realizado com sucesso!', 'success');
            }

            // Função para restaurar backup
            restaurarBackup(arquivo) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const backup = JSON.parse(e.target.result);
                        
                        if (!backup.notebooks || !backup.emprestimos || !backup.setores) {
                            this.showToast('Arquivo de backup inválido!', 'error');
                            return;
                        }

                        if (!confirm('Restaurar backup? Todos os dados atuais serão substituídos.')) {
                            return;
                        }

                        this.notebooks = backup.notebooks;
                        this.emprestimos = backup.emprestimos;
                        this.setores = backup.setores;

                        this.saveData();
                        this.renderDashboard();
                        this.renderCalendario();
                        this.renderHistorico();
                        this.renderSetores();
                        this.renderListaNotebooksEdicao();
                        this.updateNotebookOptions();
                        this.updateSetorOptions();
                        this.updateStats();
                        
                        this.showToast('Backup restaurado com sucesso!', 'success');
                    } catch (error) {
                        this.showToast('Erro ao restaurar backup!', 'error');
                        console.error('Erro no backup:', error);
                    }
                };
                
                reader.readAsText(arquivo);
            }

            // Função para estatísticas avançadas
            getEstatisticasAvancadas() {
                const total = this.emprestimos.length;
                const ativos = this.emprestimos.filter(emp => emp.status === 'ativo').length;
                const devolvidos = this.emprestimos.filter(emp => emp.status === 'devolvido').length;
                const atrasados = this.emprestimos.filter(emp => 
                    emp.status === 'ativo' && this.isAtrasado(emp.previsaoDevolucao)
                ).length;

                // Tempo médio de empréstimo
                const emprestimosDevolvidos = this.emprestimos.filter(emp => emp.status === 'devolvido');
                let tempoMedio = 0;
                if (emprestimosDevolvidos.length > 0) {
                    const totalDias = emprestimosDevolvidos.reduce((acc, emp) => {
                        const inicio = new Date(emp.dataEntrega);
                        const fim = new Date(emp.dataDevolucao);
                        return acc + Math.ceil((fim - inicio) / (1000 * 60 * 60 * 24));
                    }, 0);
                    tempoMedio = Math.round(totalDias / emprestimosDevolvidos.length);
                }

                // Taxa de utilização dos notebooks
                const notebooksUtilizados = new Set(this.emprestimos.map(emp => emp.notebookId)).size;
                const taxaUtilizacao = Math.round((notebooksUtilizados / this.notebooks.length) * 100);

                return {
                    totalEmprestimos: total,
                    emprestimosAtivos: ativos,
                    emprestimosDevolvidos: devolvidos,
                    emprestimosAtrasados: atrasados,
                    tempoMedioEmprestimo: tempoMedio,
                    taxaUtilizacaoNotebooks: taxaUtilizacao,
                    setoresMaisAtivos: this.getSetoresMaisAtivos(this.emprestimos),
                    notebooksMaisUsados: this.getNotebooksMaisUsados(this.emprestimos)
                };
            }

            // Função para limpar dados antigos (opcional)
            limparDadosAntigos(mesesAtras = 12) {
                const dataLimite = new Date();
                dataLimite.setMonth(dataLimite.getMonth() - mesesAtras);

                const emprestimosAntigos = this.emprestimos.filter(emp => 
                    emp.status === 'devolvido' && new Date(emp.dataDevolucao) < dataLimite
                );

                if (emprestimosAntigos.length === 0) {
                    this.showToast('Nenhum dado antigo encontrado para limpeza.', 'info');
                    return;
                }

                if (confirm(`Encontrados ${emprestimosAntigos.length} empréstimos antigos. Deseja removê-los?`)) {
                    this.emprestimos = this.emprestimos.filter(emp => 
                        !(emp.status === 'devolvido' && new Date(emp.dataDevolucao) < dataLimite)
                    );
                    
                    this.saveData();
                    this.renderHistorico();
                    this.showToast(`${emprestimosAntigos.length} registros antigos removidos.`, 'success');
                }
            }
        }

        // Inicializa o sistema quando a página carrega
        let sistema;
        document.addEventListener('DOMContentLoaded', function() {
            sistema = new SistemaEmprestimos();
            
            // Verifica vencimentos ao carregar
            setTimeout(() => {
                const vencimentos = sistema.verificarVencimentos();
                
                if (vencimentos.atrasados.length > 0) {
                    sistema.showToast(`${vencimentos.atrasados.length} empréstimo(s) em atraso!`, 'error');
                }
                
                if (vencimentos.vencendoHoje.length > 0) {
                    sistema.showToast(`${vencimentos.vencendoHoje.length} empréstimo(s) vencem hoje!`, 'warning');
                }
            }, 2000);
        });

        // Funções globais para atalhos de teclado
        document.addEventListener('keydown', function(e) {
            // Ctrl + 1-5 para navegar entre abas
            if (e.ctrlKey && !e.shiftKey && !e.altKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        sistema.switchTab('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        sistema.switchTab('solicitar');
                        break;
                    case '3':
                        e.preventDefault();
                        sistema.switchTab('calendario');
                        break;
                    case '4':
                        e.preventDefault();
                        sistema.switchTab('historico');
                        break;
                    case '5':
                        e.preventDefault();
                        sistema.switchTab('setores');
                        break;
                    case 'b':
                        e.preventDefault();
                        sistema.fazerBackupCompleto();
                        break;
                    case 'n':
                        e.preventDefault();
                        sistema.abrirModalAdicionarNotebook();
                        break;
                }
            }
        });

        // Service Worker para funcionamento offline (opcional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker registrado:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Falha ao registrar Service Worker:', error);
                    });
            });
        }

        // Função para detectar modo escuro do sistema
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark-mode');
        }

        // Auto-save a cada 5 minutos
        setInterval(() => {
            if (sistema) {
                sistema.saveData();
                console.log('Auto-save realizado:', new Date().toLocaleTimeString());
            }
        }, 300000); // 5 minutos

    </script>
</body>
</html>

                